---
description: 
globs: 
alwaysApply: true
---
## Design
- **Theme:**
  - Dark mode with Bitcoin orange (`#F7931A`), black, and gray tones.
  - Use Tailwind's `dark:` prefix (e.g., `dark:bg-gray-900`).

- **Charts:**
  - Implement Chart.js with responsive layouts and theme-matching colors.

- **CSV Handling:**
  - Support large/multiple CSVs (e.g., up to 100MB total across uploads).
  - Provide clear parsing progress and error feedback.
  - Max CSV size determined by performance testing (e.g., 10MB per file).

- **Removal Logic:**
  - Enable easy CSV deletion with a cancel button before uploading option 


## Data Handling
**Supabase Tables**
**Login Table for User**
- `users`: `id`, `email` (minimal info, unchanged).


### Orders Table
#### Core Fields
- `id`: Auto-incrementing primary key
- `created_at`: Timestamp of record creation
- `updated_at`: Timestamp of last update
- `user_id`: Foreign key to auth.users table
- `date`: Transaction date and time
- `type`: Transaction type (either "buy" or "sell")
- `asset`: Cryptocurrency asset (e.g., "BTC")
- `price`: Price per unit at time of transaction (e.g, usually a fiat currency however not define in table)
- `exchange`: Exchange where transaction occurred

#### Buy/Sell Fields
- `buy_fiat_amount`: Amount of fiat used for purchase
- `buy_currency`: Currency of purchase (e.g., "USD")
- `buy_btc_amount`: Amount of BTC received
- `received_btc_amount`: Amount of BTC actually received
- `received_currency`: Currency received (always "BTC")
- `sell_btc_amount`: Amount of BTC sold
- `sell_btc_currency` : Currecny of sell (e.g, "BTC")
- `received_fiat_amount`: Amount of fiat currency received from sale
- `received__fiat_currency`: Currency received (e.g., "USD")

#### Additional Details
- `exchange`: Exchange where transaction occurred

#### Fee Information
- `service_fee`: Exchange/service fee
- `service_fee_currency`: Currency of service fee

### Transfer Table
- `date`: Transaction date and time
- `type`: Transaction type (either "withdrawl" or "deposit")
- `amount_btc`: Amount of BTC withrdawl or deposited (import should accept either positive or negative)
- `fee_amount_btc` : Amount in network fees in BTC
- `amount_fiat` : Amount in USD transfered 
- `price` : Price action of BTC when the transaction occured in USD 
- `hash` : Transaction hash 


### Bitcoin History Table
**Historical Table and Hourly Update Cron Job
- `historical_prices`: `timestamp`, `date`, `price_usd`, `created_at`
- Use mempool api for one time historical import to capture hourly data (24H/ day) for one time data dump into supabase
- Create cron job to update table hourly with similar data points as a go forward after one time import

## Bitcoing All Time Table
**Bitciong ATH Table**
- `date`, `ath_date`, `price`
- Use Coinpaprike API for ATH data point

### Bitcoin Spot Table
**Bitcoing Price Table**
  - `spot_price`: `date`, `price_usd`,
  - Using Coinpaprika API (free tier)
  - Need to be cautious of rate limits

### Fear & Greed Index Table
**Fear & Greed Index Table**
  - Using Coinmaarketcap api 
  - Capture daily index number
  - Be able to GET `yesterday`, `7d ago`, `1m ago` values fromt table from query. 


### Usage Guidelines
**Transaction Types**:
   - `Buy`: Use `buy_fiat_amount`, `buy_currency`, `received_btc_amount`, `price`
   - `Sell`: Use `sell_btc_amount`, `sell_btc_currency`, `received_fiat_amount`, `recieved_fiat_currency`
   - `Receive`: Use - `received_transfer_amount`, `received_currency`
   - `Send`: Use - `sent_amount`, `sent_currency`, `network_fee`, `network_currency`

**Fee Calculation**:
   - Total fees = `service_fee`
   - Total network fee = `network_fee`
   - Always check for currency field 

**Other Calculations**:
   - `receive` and `send` should not be included in any main calculations

**Data Validation**:
   - All amounts must be positive
   - Required fields: `date`, `type`, `asset`, `price`, `buy_fiat_amount`, `buy_currency`, `received_btc_amount`, (always check for `price`, however sometimes this may be a null value which is acceptable)
   - Always check if there is a corresponding currency present, or can be sourced 

- **CSV Parsing:**
  - Process CSVs server-side; validate data before insertion.
  - Store raw CSVs in Supabase Storage for user reference.

## Calculations 
  - Portfolio Value: Sum of current value of all BTC (requires current BTC price).
  - Total BTC: Sum of all `received_btc_amount` - `sell_btc_amount`
  - Total Cost Basis: Sum of Total USD + Fee USD for all "Buy" transactions.
  - Unrealized Gains: (Current BTC Price Ã— Total BTC) - Total Cost Basis.
  - Average Buy Price: Total Cost Basis / Total BTC Bought.
  - Total ROI 
  - 30 Day Change 
  - YTD Change 
  - All Time High 

## Workflow
- **Development:**
  - Run locally with `npm run dev`.
  - Commit frequently (e.g., `git commit -m "feat: add cost basis comparison"`).
  - Deploy to Vercel; monitor performance metrics.

- **Testing:**
  - Test CSV imports with small (1KB) and large (10MB) files.
  - Validate RLS across multiple user accounts.
  - Check SEO with Lighthouse or similar tools.

